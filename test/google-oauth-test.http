### Variables
@baseUrl = http://localhost:3060
@frontendUrl = http://localhost:5173

### ====================================
### PRUEBAS DE GOOGLE OAUTH
### ====================================

### üîß CONFIGURACI√ìN PREVIA NECESARIA:
# 
# 1. Configura las siguientes variables en el .env del backend:
#    GOOGLE_CLIENT_ID=tu-client-id.apps.googleusercontent.com
#    GOOGLE_CLIENT_SECRET=tu-client-secret
#    GOOGLE_REDIRECT_URI=http://localhost:3060/auth/google/callback
#    FRONTEND_URL=http://localhost:5173
#
# 2. Aseg√∫rate de tener configuradas las URIs en Google Cloud Console:
#    - URI de redirecci√≥n: http://localhost:3060/auth/google/callback
#    - Origen autorizado: http://localhost:5173
#

### ====================================
### FLUJO COMPLETO DE AUTENTICACI√ìN
### ====================================

### 1. Iniciar autenticaci√≥n con Google (M√âTODO MANUAL)
# Este endpoint redirige al navegador a Google para autenticaci√≥n
# ‚ö†Ô∏è  NO EJECUTAR DESDE REST CLIENT - Copiar URL y abrir en navegador

# URL para copiar y pegar en el navegador:
# http://localhost:3060/auth/google

### NOTA: 
# Al abrir esa URL en el navegador:
# 1. Te redirigir√° a Google para iniciar sesi√≥n
# 2. Autorizar√°s la aplicaci√≥n
# 3. Google te redirigir√° a: http://localhost:3060/auth/google/callback?code=XXXXX
# 4. El backend procesar√° el c√≥digo y te redirigir√° a: http://localhost:5173/auth/login?code=XXXXX
# 5. El frontend completar√° la autenticaci√≥n


### ====================================
### PRUEBAS DEL ENDPOINT DE CALLBACK
### ====================================

### 2. Simular callback de Google (para testing)
# ‚ö†Ô∏è  Este endpoint normalmente solo lo llama Google
# Para probarlo manualmente, necesitas un c√≥digo v√°lido de Google

### GUARDAR EL C√ìDIGO QUE RECIBISTE DE GOOGLE AQU√ç:
@googleCode = CODIGO_QUE_OBTUVISTE_DE_GOOGLE

GET {{baseUrl}}/auth/google/callback?code={{googleCode}}

### RESPUESTA ESPERADA (si el c√≥digo es v√°lido):
# Redirige a: http://localhost:5173/auth/login?code={{googleCode}}
# El frontend luego llamar√° al endpoint para completar la autenticaci√≥n


### ====================================
### ENDPOINT PARA EL FRONTEND
### ====================================

### 3. Completar autenticaci√≥n con c√≥digo de Google
# Este es el endpoint que el frontend llama despu√©s del callback
POST {{baseUrl}}/auth/google/callback
Content-Type: application/json

{
  "code": "{{googleCode}}"
}

### RESPUESTA ESPERADA (√©xito):
# {
#   "error": false,
#   "message": "Operaci√≥n exitosa",
#   "response": {
#     "data": {
#       "accessToken": "eyJhbGciOiJIUzI1NiIs...",
#       "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
#       "user": {
#         "usuarioId": "cm...",
#         "email": "usuario@gmail.com",
#         "nombre": "Juan",
#         "apellidos": "P√©rez",
#         "estaActivo": true,
#         "emailVerificado": true,
#         "telefono": null,
#         "direccion": null,
#         "avatar": "https://lh3.googleusercontent.com/..."
#       },
#       "permissions": ["USUARIOS_LISTAR", "CLIENTES_CREAR", ...],
#       "roles": ["admin", "usuario"]
#     }
#   }
# }

### RESPUESTA ESPERADA (error - c√≥digo inv√°lido):
# {
#   "error": true,
#   "message": "Error al autenticar con Google",
#   "response": {
#     "data": null
#   }
# }


### ====================================
### VERIFICAR USUARIO CREADO
### ====================================

### 4. Guardar el accessToken de la respuesta anterior
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

### 5. Verificar informaci√≥n del usuario autenticado
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### RESPUESTA ESPERADA:
# {
#   "error": false,
#   "message": "Operaci√≥n exitosa",
#   "response": {
#     "data": {
#       "id": "cm...",
#       "email": "usuario@gmail.com",
#       "nombre": "Juan",
#       "apellidos": "P√©rez",
#       "emailVerificado": true,
#       "avatar": "https://lh3.googleusercontent.com/...",
#       "estaActivo": true,
#       "roles": [...]
#     }
#   }
# }

### 6. Verificar roles del usuario
GET {{baseUrl}}/auth/roles
Authorization: Bearer {{accessToken}}

### 7. Verificar permisos del usuario
GET {{baseUrl}}/auth/permissions
Authorization: Bearer {{accessToken}}


### ====================================
### CERRAR SESI√ìN
### ====================================

### 8. Logout
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{accessToken}}


### ====================================
### REFRESH TOKEN
### ====================================

### 9. Guardar el refreshToken de la respuesta de login
@refreshToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

### 10. Renovar tokens
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}


### ====================================
### CASOS DE PRUEBA
### ====================================

### ‚úÖ CASO 1: Usuario nuevo se registra con Google
# 1. Ir a: http://localhost:3060/auth/google
# 2. Iniciar sesi√≥n con cuenta de Google nueva
# 3. Verificar que se crea el usuario en la BD
# 4. Verificar que email est√° verificado autom√°ticamente
# 5. Verificar que se guarda el avatar de Google

### ‚úÖ CASO 2: Usuario existente hace login con Google
# 1. Ir a: http://localhost:3060/auth/google
# 2. Iniciar sesi√≥n con cuenta de Google existente en la BD
# 3. Verificar que no se duplica el usuario
# 4. Verificar que se retornan sus roles y permisos existentes

### ‚úÖ CASO 3: Usuario inactivo intenta login con Google
# 1. Desactivar usuario en la BD (estaActivo = false)
# 2. Intentar login con Google
# 3. Verificar que retorna error "Usuario inactivo"

### ‚úÖ CASO 4: C√≥digo de Google inv√°lido o expirado
# 1. Intentar usar un c√≥digo antiguo o inventado
# 2. Verificar que retorna error apropiado


### ====================================
### NOTAS IMPORTANTES
### ====================================

### üìù Sobre los c√≥digos de Google:
# - Los c√≥digos son de UN SOLO USO
# - Expiran despu√©s de ~10 minutos
# - No se pueden reutilizar
# - Deben ser intercambiados por tokens inmediatamente

### üîí Seguridad:
# - Los usuarios creados con Google tienen contrase√±a aleatoria
# - No pueden hacer login con contrase√±a tradicional
# - Deben usar siempre Google OAuth
# - El email se marca como verificado autom√°ticamente

### üéØ Datos guardados de Google:
# - Email (usado como identificador √∫nico)
# - Nombre (given_name)
# - Apellidos (family_name)
# - Avatar (picture URL)
# - Email verificado (verified_email)

### üîÑ Flujo completo:
# 1. Usuario ‚Üí Frontend ‚Üí Click "Continuar con Google"
# 2. Frontend ‚Üí Backend ‚Üí GET /auth/google
# 3. Backend ‚Üí Google ‚Üí Redirige para autenticaci√≥n
# 4. Google ‚Üí Usuario ‚Üí Pide autorizaci√≥n
# 5. Usuario ‚Üí Google ‚Üí Autoriza
# 6. Google ‚Üí Backend ‚Üí GET /auth/google/callback?code=XXX
# 7. Backend ‚Üí Google API ‚Üí Intercambia c√≥digo por token
# 8. Backend ‚Üí Google API ‚Üí Obtiene info del usuario
# 9. Backend ‚Üí Base de Datos ‚Üí Busca o crea usuario
# 10. Backend ‚Üí JWT ‚Üí Genera tokens propios
# 11. Backend ‚Üí Frontend ‚Üí Redirige con c√≥digo
# 12. Frontend ‚Üí Backend ‚Üí POST /auth/google/callback con c√≥digo
# 13. Backend ‚Üí Frontend ‚Üí Retorna tokens y datos de usuario
# 14. Frontend ‚Üí Dashboard ‚Üí Usuario autenticado


### ====================================
### TROUBLESHOOTING
### ====================================

### ‚ùå Error: "Google OAuth no est√° configurado"
# Soluci√≥n: Verifica que GOOGLE_CLIENT_ID y GOOGLE_CLIENT_SECRET 
#          est√©n en el .env del backend

### ‚ùå Error: "redirect_uri_mismatch"
# Soluci√≥n: Verifica que la URI en Google Cloud Console coincida 
#          exactamente con GOOGLE_REDIRECT_URI

### ‚ùå Error: "Error al autenticar con Google"
# Soluci√≥n: Revisa los logs del backend para m√°s detalles
#          Verifica que el c√≥digo no haya expirado

### ‚ùå Error: "Usuario inactivo"
# Soluci√≥n: Activa el usuario en la base de datos

### ‚ùå Error: "invalid_grant"
# Soluci√≥n: El c√≥digo ya fue usado o expir√≥
#          Genera un nuevo c√≥digo iniciando el flujo de nuevo


### ====================================
### ENLACES √öTILES
### ====================================

# üîó Google Cloud Console:
# https://console.cloud.google.com/

# üîó Documentaci√≥n OAuth 2.0 de Google:
# https://developers.google.com/identity/protocols/oauth2

# üîó Probar OAuth sin implementar backend:
# https://developers.google.com/oauthplayground/
