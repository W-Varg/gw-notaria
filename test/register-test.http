### Variables
@baseUrl = http://localhost:3060
@newUserEmail = kryshot05@gmail.com
@newUserPassword = Test123@Strong
@newUserNombre = Juan
@newUserApellidos = P√©rez Garc√≠a

### ===================================================
### PRUEBA COMPLETA DE REGISTRO Y VERIFICACI√ìN DE EMAIL
### ===================================================

### 1. REGISTRAR NUEVO USUARIO
# Este endpoint crear√° un usuario y enviar√° un email de verificaci√≥n a su correo
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "{{newUserPassword}}",
  "nombre": "{{newUserNombre}}",
  "apellidos": "{{newUserApellidos}}",
  "telefono": "931753472",
  "direccion": "calle Colo Colo"
}

### RESPUESTA ESPERADA:
# {
#   "error": false,
#   "message": "Operaci√≥n exitosa",
#   "response": {
#     "data": {
#       "accessToken": "eyJhbGc...",
#       "refreshToken": "eyJhbGc...",
#       "user": {
#         "usuarioId": "cm...",
#         "email": "test.user@example.com",
#         "nombre": "Juan",
#         "apellidos": "P√©rez Garc√≠a",
#         "estaActivo": true,
#         "emailVerificado": false,
#         "telefono": null,
#         "direccion": null,
#         "avatar": null
#       },
#       "roles": []
#     }
#   }
# }

### IMPORTANTE: 
### - Revisa tu bandeja de entrada del email que registraste
### - Abre el email "‚úÖ Verifica tu cuenta - Tu Notar√≠a"
### - Copia el token del enlace de verificaci√≥n
### - El token est√° despu√©s de "?token=" en la URL

### EJEMPLO DE TOKEN:
# URL: http://localhost:5173/auth/verify-email?token=a1b2c3d4e5f6...
# Token: a1b2c3d4e5f6...

@verificationToken = PEGA_AQUI_EL_TOKEN_DEL_EMAIL

### ===================================================

### 2. VERIFICAR EMAIL CON TOKEN
# Usa el token que recibiste en el email
POST {{baseUrl}}/auth/verify-email
Content-Type: application/json

{
  "token": "{{verificationToken}}"
}

### RESPUESTA ESPERADA:
# {
#   "error": false,
#   "message": "Operaci√≥n exitosa",
#   "response": {
#     "data": "Email verificado exitosamente"
#   }
# }

### IMPORTANTE:
### - Despu√©s de verificar, recibir√°s un email de bienvenida
### - Abre el email "üéâ Bienvenido a Tu Notar√≠a"

### ===================================================

### 3. INICIAR SESI√ìN CON EL USUARIO VERIFICADO
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "{{newUserPassword}}"
}

### GUARDAR EL accessToken DE LA RESPUESTA:
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

### ===================================================

### 4. OBTENER INFORMACI√ìN DEL USUARIO AUTENTICADO
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### ===================================================

### 5. RE-ENVIAR EMAIL DE VERIFICACI√ìN (si es necesario)
# Solo funciona si el email a√∫n no est√° verificado
POST {{baseUrl}}/auth/send-verification-link
Authorization: Bearer {{accessToken}}

### ===================================================
### PRUEBAS DE RECUPERACI√ìN DE CONTRASE√ëA
### ===================================================

### 6. SOLICITAR RESET DE CONTRASE√ëA
POST {{baseUrl}}/auth/forgot-password
Content-Type: application/json

{
  "email": "{{newUserEmail}}"
}

### IMPORTANTE:
### - Revisa tu email
### - Abre el email "üîê Recuperaci√≥n de contrase√±a - Tu Notar√≠a"
### - Copia el token del enlace de recuperaci√≥n

@resetToken = PEGA_AQUI_EL_TOKEN_DEL_EMAIL

### 7. RESTABLECER CONTRASE√ëA CON TOKEN
POST {{baseUrl}}/auth/reset-password
Content-Type: application/json

{
  "token": "{{resetToken}}",
  "newPassword": "NewPassword123@"
}

### ===================================================
### PRUEBAS ADICIONALES
### ===================================================

### 8. REGISTRAR OTRO USUARIO PARA PRUEBAS
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "maria.lopez@example.com",
  "password": "Maria123@Strong",
  "nombre": "Mar√≠a",
  "apellidos": "L√≥pez Rodr√≠guez"
}

### ===================================================

### 9. INTENTAR REGISTRAR CON EMAIL DUPLICADO (deber√≠a fallar)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "Test123@Strong",
  "nombre": "Otro",
  "apellidos": "Usuario"
}

### RESPUESTA ESPERADA:
# {
#   "error": true,
#   "message": "El email ya est√° registrado"
# }

### ===================================================

### 10. CAMBIAR CONTRASE√ëA (usuario autenticado)
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "currentPassword": "{{newUserPassword}}",
  "newPassword": "NewSecurePassword123@"
}

### ===================================================
### NOTAS IMPORTANTES
### ===================================================

### CONFIGURACI√ìN NECESARIA EN .ENV:
# EMAIL_FROM=kryshot05@gmail.com
# EMAIL_USER=kryshot05@gmail.com
# EMAIL_PASS=ikhy abc szvb fzlf
# EMAIL_SERVICE=gmail
# ENV_FRONT_APP_URL=http://localhost:5173

### FLUJO COMPLETO DE REGISTRO:
# 1. Usuario se registra ‚Üí Recibe email de verificaci√≥n
# 2. Usuario hace clic en el enlace del email ‚Üí Email verificado
# 3. Usuario recibe email de bienvenida
# 4. Usuario puede iniciar sesi√≥n normalmente

### FLUJO DE RECUPERACI√ìN DE CONTRASE√ëA:
# 1. Usuario solicita reset ‚Üí Recibe email con enlace
# 2. Usuario hace clic en el enlace ‚Üí Ingresa nueva contrase√±a
# 3. Contrase√±a actualizada exitosamente

### VALIDACIONES DEL SISTEMA:
# - Email √∫nico (no duplicados)
# - Contrase√±as encriptadas con bcrypt
# - Tokens de un solo uso
# - Emails con plantillas HTML profesionales
# - Verificaci√≥n requerida antes de ciertas acciones
