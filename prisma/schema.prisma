/// Este es tu archivo de esquema Prisma
/// Aprende más sobre esto en la documentación: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

// /// https://github.com/dbgso/prisma-generator-plantuml-erd/tree/main/packages/generator

// generator erd_plantuml {
//   provider                   = "prisma-generator-plantuml-erd"
//   output                     = "erd.puml"
//   exportPerTables            = true
//   showUniqueKeyLabel         = true
//   isShowForeignKeyOnRelation = true
// }

// /// https://github.com/kimjbstar/prisma-class-generator

// generator prismaClassGenerator {
//   provider   = "prisma-class-generator"
//   output     = "../src/generated/class-generator"
//   dryRun     = "false"
//   useSwagger = "true"
// }

// /// https://github.com/unlight/prisma-nestjs-graphql

// generator nestgraphql {
//   provider = "node node_modules/prisma-nestjs-graphql"
//   output   = "../src/generated/graphql-nestjs"
// }

// /// https://github.com/vegardit/prisma-generator-nestjs-dto

// generator nestjsDto {
//   provider                        = "prisma-generator-nestjs-dto"
//   output                          = "../src/generated/nestjs-dto"
//   outputToNestJsResourceStructure = "true"
//   exportRelationModifierClasses   = "true"
//   reExport                        = "false"
//   createDtoPrefix                 = "Create"
//   updateDtoPrefix                 = "Update"
//   dtoSuffix                       = "Dto"
//   entityPrefix                    = ""
//   entitySuffix                    = ""
//   fileNamingStyle                 = "camel"
// }

// /// https://github.com/omar-dulaimi/prisma-class-validator-generator

// generator class_validator {
//   provider = "prisma-class-validator-generator"
//   output   = "../src/generated/validator-generator"
// }

/// Enums

enum EstadoPedido {
  PENDIENTE
  CONFIRMADO
  EN_PREPARACION
  LISTO_PARA_ENTREGA
  ENTREGADO
  CANCELADO
  REEMBOLSADO
}

enum EstadoEntrega {
  PENDIENTE
  PROGRAMADA
  EN_CAMINO
  ENTREGADA
  CANCELADA
}

enum UnidadMedida {
  Gramos
  Klg
  Unidad
  Caja
  Paquete
}

enum DiaSemana {
  Lunes
  Martes
  Miercoles
  Jueves
  Viernes
  Sabado
  Domingo
}

// ============================================
// MÓDULO DE SEGURIDAD Y USUARIOS
// ============================================

model Rol {
  id                 Int          @id @default(autoincrement())
  nombre             String       @unique
  descripcion        String?
  estaActivo         Boolean      @default(true)
  fechaCreacion      DateTime     @default(now())
  fechaActualizacion DateTime     @updatedAt
  // Relaciones
  usuarioRoles       UsuarioRol[]
  rolPermisos        RolPermiso[]

  @@map("auth_roles")
}

model Permiso {
  id          Int          @id @default(autoincrement())
  nombre      String       @unique
  descripcion String?
  modulo      String // ej: "productos", "pedidos", "usuarios", "reportes"
  accion      String // ej: "crear", "leer", "actualizar", "eliminar"
  estaActivo  Boolean      @default(true)
  // Relaciones
  rolPermisos RolPermiso[]

  @@map("auth_permisos")
}

model RolPermiso {
  id Int @id @default(autoincrement())

  rolId     Int
  permisoId Int
  // Relaciones
  rol       Rol     @relation(fields: [rolId], references: [id], onDelete: Cascade)
  permiso   Permiso @relation(fields: [permisoId], references: [id], onDelete: Cascade)

  @@unique([rolId, permisoId])
  @@map("auth_rol_permisos")
}

model Usuario {
  id                 String            @id @default(cuid())
  email              String            @unique @db.VarChar(150)
  password           String            @db.VarChar(150)
  nombre             String            @db.VarChar(30)
  apellidos          String            @db.VarChar(30)
  telefono           String?           @db.VarChar(10)
  direccion          String?
  avatar             String?
  estaActivo         Boolean           @default(true)
  emailVerificado    Boolean           @default(false)
  fechaCreacion      DateTime          @default(now())
  fechaActualizacion DateTime          @updatedAt
  // Relaciones de seguridad
  roles              UsuarioRol[]
  // Relaciones de negocio
  mensajesContacto   MensajeContacto[]
  // Relación con empleado

  @@map("auth_usuarios")
}

model UsuarioRol {
  id        Int     @id @default(autoincrement())
  usuarioId String
  rolId     Int
  // Relaciones
  usuario   Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  rol       Rol     @relation(fields: [rolId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, rolId])
  @@map("auth_usuario_roles")
}

// ============================================
// MÓDULO DE PRODUCTOS Y CATEGORÍAS
// ============================================

model Categoria {
  id                 String   @id @default(cuid())
  nombre             String   @unique
  descripcion        String?
  imagen             String?
  estaActiva         Boolean  @default(true)
  fechaCreacion      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  // Relaciones
  productos Producto[]

  @@map("cat_categorias")
}

model TipoProducto {
  id        String     @id @default(cuid())
  nombre    String     @unique
  productos Producto[]

  @@map("cat_tipos_producto")
}

model Producto {
  id                 String       @id @default(cuid())
  nombre             String
  descripcion        String?      @db.VarChar(500)
  precio             Float
  peso               Float // peso en gramos
  // unidad             String           @default("gramos") // "gramos", "kg", "unidad"
  unidad             UnidadMedida
  stock              Int          @default(0)
  codigoSKU          String       @unique
  estaActivo         Boolean      @default(true)
  fechaCreacion      DateTime     @default(now())
  fechaActualizacion DateTime     @updatedAt
  tipoProductoId     String
  // Relaciones
  categoriaId        String
  categoria          Categoria    @relation(fields: [categoriaId], references: [id])
  tipo               TipoProducto @relation(fields: [tipoProductoId], references: [id])

  @@map("prod_productos")
}

// ============================================
// MÓDULO DE CONTACTO
// ============================================

model MensajeContacto {
  id                 String   @id @default(cuid())
  usuarioId          String? // opcional, puede ser un usuario anónimo
  nombre             String
  correo             String
  telefono           String?
  asunto             String
  mensaje            String
  categoria          String   @default("consulta") // "consulta", "queja", "sugerencia", "reclamo", "felicitacion", "otro"
  estado             String   @default("no_leido") // "no_leido", "leido", "en_proceso", "respondido", "cerrado"
  fechaCreacion      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  // Relaciones
  usuario Usuario? @relation(fields: [usuarioId], references: [id])

  @@map("int_mensajes_contacto")
}

// ============================================
// MÓDULO DE CONFIGURACIÓN DEL SISTEMA
// ============================================

model ConfiguracionSistema {
  id                 String   @id @default(cuid())
  clave              String   @unique
  valor              String
  tipo               String   @default("texto") // "texto", "numero", "booleano", "json"
  descripcion        String?
  fechaActualizacion DateTime @updatedAt

  @@map("_configuracion_sistema")
}
